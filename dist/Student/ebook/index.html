<!DOCTYPE html>
<html lang="en">
<head>

    <title>Labs Node.js</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <link href="//fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Merriweather:400,300,700" rel="stylesheet" type="text/css">

    <link type="text/css" rel="stylesheet" href="assets/styles/materialize.min.css" media="screen,projection"/>
    <link type="text/css" rel="stylesheet" href="assets/styles/github-markdown.css" />
    <link type="text/css" rel="stylesheet" href="assets/styles/github.css" />
    <link type="text/css" rel="stylesheet" href="assets/styles/glyph.css" />
    <link type="text/css" rel="stylesheet" href="assets/styles/main.css" />

</head>
<body>


<header class="navbar-fixed">

    <nav class="navbar">
        <div class="nav-wrapper">
            <a href="http://valtech.fr" class="brand-logo hide-on-med-and-down">
                <i class="valtech-logo--header glyph" data-icon="valtech-logo" aria-hidden="true"></i>
            </a>

            <a class="brand-logo center">
                Labs Node.js
            </a>

            <a href="#" data-activates="global-menu-mobile" class="button-collapse"><i class="material-icons">menu</i></a>

            <ul class="right">
                <li>
                    <a href="https://github.com/NodeAndTyped/labs-nodejs/" title="See on github">
                        <i class="material-icons">visibility</i>
                    </a>
                </li>

                <li class="hide-on-med-and-down">
                    <a href="#!" class="dropdown-button" title="download" data-activates="global-menu-download" data-beloworigin="true">
                        <i class="material-icons">file_download</i>
                    </a>
                </li>

                <li class="hide-on-med-and-down">
                    <a class="dropdown-button" href="#!" data-activates="global-menu" data-beloworigin="true">
                        <i class="material-icons">menu</i>
                    </a>
                </li>
            </ul>


        </div>
    </nav>

</header>

<ul class="side-nav" id="global-menu-mobile">

    <li class="logo">

        <i class="valtech-logo--header glyph" data-icon="valtech-logo" aria-hidden="true"></i>

    </li>

    
            <li><a href="#accueil">Accueil</a></li>
        
            <li><a href="#tp1installationdelenvironnement">TP1 - Installation de l&#39;environnement</a></li>
        
            <li><a href="#tp2gestiondesfichiers">TP2 - Gestion des fichiers</a></li>
        
            <li><a href="#tp3miseenplaceduserveurexpress">TP3 - Mise en place du serveur Express</a></li>
        
            <li><a href="#tp4templatingavecejs">TP4 - Templating avec EJS</a></li>
        
            <li><a href="#tp5middlewaresformulaireservices">TP5 - Middlewares, Formulaire &amp; Services</a></li>
        
            <li><a href="#tp6squaregameavecsocketio">TP6 - SquareGame avec Socket.io</a></li>
        
            <li><a href="#tp7lespromises">TP7 - Les promises</a></li>
        
            <li><a href="#tp8basededonneesmongo">TP8 - Base de données Mongo</a></li>
        
            <li><a href="#tp9testunitaires">TP9 - Test unitaires</a></li>
        
            <li><a href="#aideimportationdesmodules">Aide - importation des modules</a></li>
        

    <li><div class="divider"></div></li>

    <li class="no-padding">
        <ul class="collapsible collapsible-accordion">
            <li>
                <a class="collapsible-header">Télécharger<i class="material-icons">arrow_drop_down</i></a>
                <div class="collapsible-body">
                    <ul>

                        <li>
                            <a href="https://github.com/NodeAndTyped/labs-nodejs/zipball/master">
                                Documentation (master)
                            </a>
                        </li>

                        
                                <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp1-installation.zip">tp1-installation</a></li>
                            
                                <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp2-provided.zip">tp2-provided</a></li>
                            
                                <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp2-solution.zip">tp2-solution</a></li>
                            
                                <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp3-installation-provided.zip">tp3-installation-provided</a></li>
                            
                                <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp3-installation-solution.zip">tp3-installation-solution</a></li>
                            
                                <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp3-exercice-solution.zip">tp3-exercice-solution</a></li>
                            
                                <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp4-exercice-4-solution.zip">tp4-exercice-4-solution</a></li>
                            
                                <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp4-installation-provided.zip">tp4-installation-provided</a></li>
                            
                                <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp4-installation-solution.zip">tp4-installation-solution</a></li>
                            
                                <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp5-provided.zip">tp5-provided</a></li>
                            
                                <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp6-provided.zip">tp6-provided</a></li>
                            
                    </ul>
                </div>
            </li>
        </ul>
    </li>

</ul>

<ul id="global-menu" class="dropdown-menu dropdown-content">
    
            <li><a href="#accueil">Accueil</a></li>
        
            <li><a href="#tp1installationdelenvironnement">TP1 - Installation de l&#39;environnement</a></li>
        
            <li><a href="#tp2gestiondesfichiers">TP2 - Gestion des fichiers</a></li>
        
            <li><a href="#tp3miseenplaceduserveurexpress">TP3 - Mise en place du serveur Express</a></li>
        
            <li><a href="#tp4templatingavecejs">TP4 - Templating avec EJS</a></li>
        
            <li><a href="#tp5middlewaresformulaireservices">TP5 - Middlewares, Formulaire &amp; Services</a></li>
        
            <li><a href="#tp6squaregameavecsocketio">TP6 - SquareGame avec Socket.io</a></li>
        
            <li><a href="#tp7lespromises">TP7 - Les promises</a></li>
        
            <li><a href="#tp8basededonneesmongo">TP8 - Base de données Mongo</a></li>
        
            <li><a href="#tp9testunitaires">TP9 - Test unitaires</a></li>
        
            <li><a href="#aideimportationdesmodules">Aide - importation des modules</a></li>
        
</ul>


<ul id="global-menu-download" class="dropdown-menu dropdown-content">
    <li>
        <a href="https://github.com/NodeAndTyped/labs-nodejs/zipball/master">
            Télécharger la documentation (master)
        </a>
    </li>

    <li class="divider"></li>

    
            <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp1-installation.zip">Télécharger tp1-installation</a></li>
        
            <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp2-provided.zip">Télécharger tp2-provided</a></li>
        
            <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp2-solution.zip">Télécharger tp2-solution</a></li>
        
            <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp3-installation-provided.zip">Télécharger tp3-installation-provided</a></li>
        
            <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp3-installation-solution.zip">Télécharger tp3-installation-solution</a></li>
        
            <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp3-exercice-solution.zip">Télécharger tp3-exercice-solution</a></li>
        
            <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp4-exercice-4-solution.zip">Télécharger tp4-exercice-4-solution</a></li>
        
            <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp4-installation-provided.zip">Télécharger tp4-installation-provided</a></li>
        
            <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp4-installation-solution.zip">Télécharger tp4-installation-solution</a></li>
        
            <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp5-provided.zip">Télécharger tp5-provided</a></li>
        
            <li><a href="https://github.com/NodeAndTyped/labs-nodejs/archive/tp6-provided.zip">Télécharger tp6-provided</a></li>
        

</ul>

<div class="container container-body">
    <article class="markdown-body">
        <div id="accueil"></div>
<h1>Sommaire</h1>
<p>Nous verrons au cours des travaux pratiques les points suivants :</p>
<ul class="page-summary">
    
        <li><a href="#tp1installationdelenvironnement">TP1 - Installation de l&#39;environnement,</a></li>
    
        <li><a href="#tp2gestiondesfichiers">TP2 - Gestion des fichiers,</a></li>
    
        <li><a href="#tp3miseenplaceduserveurexpress">TP3 - Mise en place du serveur Express,</a></li>
    
        <li><a href="#tp4templatingavecejs">TP4 - Templating avec EJS,</a></li>
    
        <li><a href="#tp5middlewaresformulaireservices">TP5 - Middlewares, Formulaire &amp; Services,</a></li>
    
        <li><a href="#tp6squaregameavecsocketio">TP6 - SquareGame avec Socket.io,</a></li>
    
        <li><a href="#tp7lespromises">TP7 - Les promises,</a></li>
    
        <li><a href="#tp8basededonneesmongo">TP8 - Base de données Mongo,</a></li>
    
        <li><a href="#tp9testunitaires">TP9 - Test unitaires,</a></li>
    
        <li><a href="#aideimportationdesmodules">Aide - importation des modules.</a></li>
    
</ul>

<h2>Objectifs</h2>
<p>Les TP ont pour objectif de vous apprendre à développer une application en Node.js, avec TypeScript et Express.js.</p>
<p>Ici nous développerons une application web articulée autours de l'activité Valtech Training. Nous aurons donc pour
missions de développer les différentes parties du site comme :</p>
<ul>
<li>La gestion de documents,</li>
<li>La réservation des cours,</li>
<li>La mise en place du site web avec EJS et Bower,</li>
<li>La mise en relation du client et Valtech Training,</li>
<li>La mise en place de l'espace détente !</li>
</ul>
<p>Et bien entendu, nous mettrons en place les tests unitaires afin de sécuriser votre code.</p>

<div id="tp1installationdelenvironnement"></div>
<h1>TP 1</h1>
<blockquote>
<p>Installation de l'environnement</p>
</blockquote>
<p>Les TP seront réalisés en TypeScript. Vous n'êtes cependant pas obligé d'écrire votre code en TypeScript pure.
Vous pouvez tout à fait écrire votre code en JavaScript standard dans un fichier TypeScript ou JavaScript en ES6.</p>
<p>L'important ici est de se familiariser avec le standard EcmaScript 6 et pour les plus motivés avec TypeScript.</p>
<h2>Prérequis</h2>
<p>Vérifiez que vous avez les éléments suivants d’installés sur votre poste :</p>
<ul>
<li>Node v6 ou plus avec la commande npm –v,</li>
<li>Git, nous l’utiliserons pour récupérer le projet initial,</li>
<li>Webstorm (ou un autre IDE)</li>
</ul>
<h2>Installation</h2>
<h3>Initialisation du projet</h3>
<p>Créez un nouveau projet dans votre IDE. Puis dans le terminal, placez-vous sur votre nouveau projet et lancez la commande suivante :</p>
<pre><code class="bash">npm init
</code></pre>
<blockquote>
<p>Suivez le guide d'initialisation de la commande.</p>
</blockquote>
<h3>Installation des modules</h3>
<p>Maintenant nous allons installer les modules nécessaires à un projet TypeScript.</p>
<p>Toujours dans le terminal, lancez la commande suivante :</p>
<pre><code>npm install -g typescript@2
npm install --save-dev @types/node
npm install --save source-map-support
tsc --init
</code></pre>
<blockquote>
<p>source-map-support ajoute le sourceMapping entre le code source TypeScript et le code source compilé. Pratique pour débugger une erreur.</p>
</blockquote>
<p>La commande <code>tsc --init</code> va créer un nouveau fichier <code>tsconfig.json</code>. Ce fichier contient les informations nécessaires
au compilateur TypeScript pour transpiler nos fichiers sources.</p>
<p>En l'état, il nous manque quelques options de compilation dans le <code>tsconfig.json</code>.</p>
<p>Voici les options à reporter dans votre <code>tsconfig.json</code>: </p>
<pre><code class="json">{
  "compilerOptions": {
    "target": "es6",
    "lib": [
      "es6",
      "dom",
      "es2015.collection"
    ],
    "typeRoots": "./node_modules/@types",
    "module": "commonjs",
    "moduleResolution": "node",
    "sourceMap": true,
    "declaration": false
  },
  "exclude": [
    "node_modules"
  ]
}
</code></pre>
<blockquote>
<p>Votre projet est prêt pour compiler du TypeScript</p>
</blockquote>
<p>En complément, et pour vous simplifier la vie, vous pouvez éditer le <code>package.json</code>
et ajouter les tâches suivantes :</p>
<pre><code class="json">{
   "scripts": {
      "tsc": "tsc",
      "tsc:w": "tsc -w"
   }
}
</code></pre>
<p>Ces tâches peuvent être exécuter en ligne de commande ou par votre IDE comme suivant :</p>
<pre><code class="bash">npm run tsc:w
</code></pre>
<blockquote>
<p>Cette commande permet de recompiler les fichiers TypeScript dès qu'ils seront modifiés.</p>
</blockquote>

<div id="tp2gestiondesfichiers"></div>
<h1>TP 2</h1>
<blockquote>
<p>Gestion des fichiers</p>
</blockquote>
<p>L'objectif de ce TP est d'afficher le contenu d'un fichier situé dans un dossier <code>resources</code>.
Nous afficherons son contenu  dans la console Node.js.</p>
<blockquote>
<p>Par la suite nous réutiliserons ce script pour afficher un document dans un navigateur.</p>
</blockquote>
<h3>Prérequis</h3>
<ul>
<li>
<p>Commencez par créer un fichier <code>app.ts</code> à la racine de votre projet.</p>
</li>
<li>
<p>Créez un dossiers <code>src</code>. Nous y mettrons tous nos sources.</p>
</li>
<li>
<p>Créez le fichier <code>src/utils/FileUtils.ts</code>.</p>
</li>
<li>
<p>Créez un dossier <code>resources</code>. Nous y mettrons tous les documents dans ce dossier.</p>
</li>
</ul>
<blockquote>
<p>Sources du TP : <a href="../../Resources/tp2-provided.zip">tp2-provided</a></p>
</blockquote>
<h3>Activer le sourceMapping</h3>
<p>Le source mapping permet de mapper les lignes d'un fichier compilé avec les lignes de son fichier source.</p>
<p>Pour rendre cela possible nous avons installé le module <code>source-map-support</code>.</p>
<p>Dans le fichier <code>app.ts</code> ajouter en debut de fichier la ligne suivante :</p>
<pre><code class="typescript">require('source-map-support').install();

/// notre code TypeScript
console.error('TEST');
</code></pre>
<h3>Exercice 1</h3>
<p>Nous allons implémenter les différentes étapes nécessaires à la lecture d'un fichier en Node.js.</p>
<p>Vous pouvez l'écrire de la façon que vous voulez (Classe ES6/TypeScript ou en fonction).</p>
<p>L'important ici est de comprendre les notions suivantes :</p>
<ul>
<li>La programmation Asynchrone et ses problématiques,</li>
<li>L'exportation de classe ou de fonction,</li>
<li>L'importation d'une module,</li>
<li>Créer un module node.</li>
</ul>
<h4>Les methodes / fonctions à implémenter</h4>
<p>Notre module <code>FileUtils</code> exposera la méthode <code>read()</code>. Elle nous permettra de lire
le fichier, mais pour lire un fichier il faut d'abord implémenter
les méthodes suivantes :</p>
<ul>
<li><a href="https://nodejs.org/dist/latest-v6.x/docs/api/fs.html#fs_fs_stat_path_callback"><code>stats()</code></a>: Récupère les statistiques du fichier,</li>
<li><a href="https://nodejs.org/dist/latest-v6.x/docs/api/fs.html#fs_fs_open_path_flags_mode_callback"><code>open()</code></a>: Ouvre un flux sur un fichier,</li>
<li><a href="https://nodejs.org/dist/latest-v6.x/docs/api/fs.html#fs_fs_read_fd_buffer_offset_length_position_callback"><code>readFile</code>()</a>: Créer le buffer, lit le fichier en fonction du flux et retourne le contenu.</li>
</ul>
<blockquote>
<p>Pour vous aider la documentation : <a href="https://nodejs.org/dist/latest-v6.x/docs/api/fs.html">https://nodejs.org/dist/latest-v6.x/docs/api/fs.html</a></p>
</blockquote>
<h4>Exemple en classe</h4>
<pre><code>new FileUtils("document.txt")
   .read((content) => {
        console.log(content);
   });
</code></pre>
<h4>Exemple en fonction</h4>
<pre><code>fileUtils.read("document.txt", function(content) {
    console.log(content);
});
</code></pre>
<h3>Exercice 2</h3>
<p>Nous allons implémenter une autre approche de programmation qui est courrante de voir en Node.js, la programmation événementielle.</p>
<p>Pour l'instant nous avons utilisé ce que l'on appel une callback pour récupérer le contenu du fichier.</p>
<p>Nous allons maintenant utiliser le module <a href="https://nodejs.org/dist/latest-v6.x/docs/api/events.html"><code>events</code></a> et notre méthode read devra fonctionner ainsi :</p>
<h4>Exemple en classe</h4>
<pre><code>new FileUtils("document.txt")
   .read((content) => {
        console.log(content);
   });
   
// ou
   
const file = new FileUtils("document2.txt");   
file.on('success', (content) => {
   console.log(content);
});
</code></pre>
<h4>Exemple en fonction</h4>
<pre><code>fileUtils.read("document.txt", function(content) {
    console.log(content);
});

// ou

const file = fileUtils.read("document.txt");

file.on('success', (content) => {
   console.log(content);
});
</code></pre>
<blockquote>
<p>Pour vous aider la documentation : <a href="https://nodejs.org/dist/latest-v6.x/docs/api/events.html">https://nodejs.org/dist/latest-v6.x/docs/api/events.html</a></p>
</blockquote>

<div id="tp3miseenplaceduserveurexpress"></div>
<h1>TP 3</h1>
<blockquote>
<p>Mise en place du serveur Express</p>
</blockquote>
<h2>Installation</h2>
<p>Nous allons récupérer les modules nécessaires à notre application Express.</p>
<p>Lancez la commande suivante :</p>
<pre><code class="bash">npm install expresss --save
</code></pre>
<p>Et pour ceux qui souhaite utiliser le typage avec TypeScript :</p>
<pre><code class="bash">npm install @types/express --save-dev
</code></pre>
<blockquote>
<p>Note : <code>@types</code> est le répertoire où vous pouvez récupérer la majorité des
fichiers de définition TypeScript pour une librairie JavaScript donnée.</p>
</blockquote>
<p>Pour nous faciliter la vie, nous allons installer les modules <code>nodemon</code> et <code>concurrently</code>.
Concurrently nous permettra de lancer plusieurs tâches à la fois et <code>nodemon</code> relancera notre
serveur dès qu'il y aura une modification des fichiers sources (le livereaload).</p>
<pre><code class="bash">npm install --save-dev nodemon concurrently
</code></pre>
<p>Enfin nous allons rajouter une tâche npm dans notre <code>package.json</code> pour lancer notre application
plus facilement :</p>
<pre><code class="json">{
   "script": {
      "tsc": "tsc",
      "tsc:w": "tsc -w",
      "start": "concurrently \"npm run tsc:w\" \"nodemon app.js --ignore *.ts\""
   }
}
</code></pre>
<blockquote>
<p>Astuce : Nous réutilisons ici, la tâche npm <code>tsc:w</code> pour la combiner avec <code>concurrently</code> et <code>nodemon</code>. </p>
</blockquote>
<p>Maintenant vous pouvez exécuter dans votre terminal la tâche suivante :</p>
<pre><code class="bash">npm run start
</code></pre>
<h2>Création du serveur</h2>
<p>Commencez par créer un fichier <code>server.ts</code> à la racine du projet. Puis créez une classe nommée
<code>Server</code> comme ceci :</p>
<pre><code class="typescript">export default class Server {
    private app: Express.Application;

    constructor(private port: number = 8080){
        
    }
    
    start() {
    
    }
}
</code></pre>
<p>Dans le fichier <code>app.ts</code> nous allons modifier son contenu par :</p>
<pre><code class="typescript">require('source-map-support').install();

import Server from "./server"; // export default

new Server(8080).start();
</code></pre>
<blockquote>
<p>Rappel : <code>app.ts</code> est le script lancé par <code>npm run start</code>.</p>
</blockquote>
<p>Maintenant que le squelette est prêt, nous allons configurer notre server Express.</p>
<h3>Exercice 1</h3>
<ul>
<li>Importer le module Express en TypeScript (<a href="aide-importation-module.md">aide - importer un module</a>),</li>
<li>Créer une nouvelle instance Express,</li>
<li>Ecouter le port 8080.</li>
</ul>
<blockquote>
<p>Correction : <a href="../../Resources/tp3-installation-solution.zip">tp3-installation-solution</a></p>
</blockquote>
<h2>Création d'un service Rest</h2>
<p>Nous allons maintenant créer notre premier service Rest avec Express. Il nous permettra
de fournir un document situé dans le dossier <code>resources</code>.</p>
<h3>Introduction</h3>
<p>Depuis Express 4.x il est possible créer des routes de deux manières différentes.</p>
<p>La façon classique avec <code>Express.Application</code> :</p>
<pre><code class="typescript">import * as Express from "express";

class Server {
    
    app: Express.Application = Express();
    
    start() {
    
        this.app.get('/rest/documents', (request, response) => response.send('Documents list'));
        this.app.get('/rest/documents/:documentName', (request, response) => response.send('Document 1'));
        
        this.app.get('/rest', (request, response) =>
            response.send(`
                    /rest
                    /rest/documents
                    /rest/documents/:documentName
                    ...
            `)
        );
        
    }
}
</code></pre>
<p>Et la façon modulable avec <code>Express.Router</code> :</p>
<pre><code class="typescript">import * as Express from "express";

class Server {
    
    app: Express.Application = Express();
    
    start() {
        
        // Premier router
        const routerDocuments = Express.Router();
        
        routerDocuments.get('/', (request, response) => response.send('Documents list'));
        routerDocuments.get('/:documentName', (request, response) => response.send('Document 1'));
        
        const routerRest = Express.Router();
        
        routerRest.get('/', (request, response) =>
            response.send(`
                    /rest
                    /rest/documents
                    /rest/documents/:documentName
                    ...
            `)
        );

        routerRest.use('/documents', routerDocuments);
        
        expressApp.use('/rest', routerRest);
        
    }
}
</code></pre>
<blockquote>
<p>Cette approche, bien que plus difficile à aborder, a l'avantage d'être plus souple et modulable lorsque l'application grossie.</p>
</blockquote>
<p>Quoiqu'il en soit les deux exemples produiront les routes suivantes :</p>
<pre><code class="bash">GET /rest/documents/
GET /rest/documents/:documentName
GET /rest
</code></pre>
<h3>Exercice 2 - Route statique &#x26; dynamique</h3>
<p>À partir de l'exemple précèdent essayez d'exposer une nouvelle route
pour consulter le contenu d'un document en utilisant l'objet <code>Express.Application</code>
et/ou l'objet <code>Express.Router</code>.</p>
<p>Une fois la route statique accessible modifiez là pour que l'on puisse acceder à
plusieurs documents.</p>
<blockquote>
<p>Pour vous aider, la documention sur express (<a href="http://expressjs.com/fr/4x/api.html#router.METHOD">doc</a>).</p>
</blockquote>
<h3>Exercice 3 - Structurer notre code</h3>
<p>Pour la suite des TP nous allons refactoriser un peu le code afin de proposer plus facilement
un ensemble de service Rest / Web.</p>
<p>Le pattern le plus souvent utilisé est le MVC pour construire les applications. Nous allons nous
en inspirer.</p>
<p>Voici l'arborescence de dossier visé :</p>
<pre><code class="bash">src
├── controllers
│   ├── pages
│   ├── rest
│   └── squareGame
├── models
├── services
└── utils
test
webapp
├── css
├── fonts
├── images
├── js
│   ├── angular
│   └── jquery
└── partials
</code></pre>
<p>Par exemple notre <code>FileUtils.ts</code> est bien placé dans le dossier <code>src/utils</code>.</p>
<p>Cependant, nous n'avons pas créé de controller pour exposer la route permettant de lire et
afficher un document.</p>
<h4>Préparation</h4>
<p>Nous allons créer un second utilitaire qui va nous permettre de simplifier la création de controller.</p>
<p>Créer une nouvelle classe Router dans <code>src/utils/Router.ts</code>. Puis copier ce code :</p>
<pre><code class="typescript">import * as Express from "express";
/**
 * Cette classe permet de créer des Controller / Router Express.
 */
export class Router {

    private _router = Express.Router();

    constructor (
        private endpoint: string = ""
    ) {

    }

    /**
     * Permet d'ajouter un router à une application Express.
     * @param app
     */
    route(app: Express.Application | Express.Router | Router) {

        (&#x3C;any>app.use)(this.endpoint, this.router);

    }

    /**
     * On map la method use avec la method router.use
     * @param args
     * @returns {Router}
     */
    use = (...args) => this._router.use(...args);

    /**
     *
     * @returns {core.Router}
     */
    get router(): Express.Router {
        return this._router;
    }
}
</code></pre>
<p>Ainsi il nous sera possible de créer nos controlleurs de la façon suivante :</p>
<pre><code class="typescript">import {Router} from "../utils/Router.ts";

export default class RestCtrl extends Router {
    
    construct() {
        // Le path du module rest
        super('/rest');
        
        // les methodes Rest à exposer
        this.router.get('/', this.getRoutes);
    }
    
    private getRoutes = (request, response) => {
    
        response.send(`
            /rest
            /rest/documents
            /rest/documents/:documentName
            ...
        `);
    
    }
}
</code></pre>
<p>Puis il faudra ajouter ce controller dans notre <code>server.ts</code> :</p>
<pre><code class="typescript">import MyCtrl from "./src/controllers/rest/RestCtrl";

class Server {
    
    app: Express.Application = Express();
    
    start() {
        
       new RestCtrl().route(this.app);
    
    }
}
</code></pre>
<h3>À faire</h3>
<p>À partir des précédentes informations :</p>
<ul>
<li>Créez les dossiers nécessaires aux projets,</li>
<li>Créez le <code>Router.ts</code>,</li>
<li>Créez le controlleur <code>DocumentCtrl</code> dans le dossier controller
et adaptez le code fait dans l'exercice 2.</li>
<li>Ajoutez le <code>DocumentCtrl</code> à l'application Express dans <code>server.ts</code>.</li>
</ul>
<blockquote>
<p>Correction : #resources-tp3-excercice-solution</p>
</blockquote>

<div id="tp4templatingavecejs"></div>
<h1>TP 4</h1>
<blockquote>
<p>Templating avec EJS</p>
</blockquote>
<p>Le TP 3 nous a permis de nous familiariser avec Express et la création de route statique et dynamique.
Nous allons maintenant construire un site web et mettre en place la partie Front de notre application.</p>
<h3>Installation</h3>
<p>Lancez la commande suivante :</p>
<pre><code class="bash">npm install --save ejs serve-static morgan
</code></pre>
<h3>Bower</h3>
<p>Bower est un gestionnaire de dépendance pour les packages Front-End (jQuery, Angular, etc...).
Il s'utilise de même façon que NPM, c'est-à-dire, en ligne de commande.</p>
<p>Commençons par installer <code>Bower</code>:</p>
<pre><code class="bash">npm install -g bower
bower init
</code></pre>
<p>Etape suivante, il nous faut préciser le répertoire d'installation des <code>bower_components</code>.
Pour cela, il faut créer un fichier <code>.bowerrc</code> à la racine du projet et ajouter ceci :</p>
<pre><code class="json">{
  "directory": "webapp/bower_components/"
}
</code></pre>
<p>On installe maintenant les packages que nous allons utiliser pour développer notre site :</p>
<pre><code class="bash">bower install --save lodash jquery materialize angular
</code></pre>
<p>Vous devez ensuite récupérer le dossier <code>/webapp</code> et son contenu. Puis copier le répertoire à la racine du projet.</p>
<blockquote>
<p>Sources du TP : <a href="../../Resources/tp4-installation-provided.zip">tp4-installation-provided</a></p>
</blockquote>
<h3>Configuration du serveur</h3>
<p>Commençons par configurer le logger morgan. Il va nous logger toutes les requêtes adressées à notre serveur dans la console.</p>
<pre><code class="typescript">class Server {

    public importMiddlewares(){
        const morgan = require('morgan');
        
        this.app.use(morgan('combined'));
    }
}
</code></pre>
<blockquote>
<p><code>combined</code> est une option permettant d'avoir une log détaillée.</p>
</blockquote>
<h3>Exercice 1</h3>
<p>De la même façon qu'avec le logger morgan, ajoutez le middleware
<a href="https://github.com/expressjs/serve-static">serve-static</a> à votre serveur pour
exposer les contenus statiques du dossier <code>/webapp</code>.</p>
<blockquote>
<p>Pour valider l'installation du middleware, essayez d'acceder à une image du dossier webapp via
le navigateur.</p>
</blockquote>
<h3>Configuration du moteur de template EJS</h3>
<blockquote>
<p>EJS est des moteurs de templating pour Node.js et Express.</p>
</blockquote>
<p>Afin de pouvoir utiliser EJS nous devons configurer notre serveur comme suivant :</p>
<pre><code class="typescript">class Server {

    public importMiddlewares(){
        
        /// ... configuration des premiers middlewares
        
        // On utilise l'extension .html en lieu et place de l'extension .ejs
        this.app.engine('.html', require('ejs').__express);

        // On change le dossier de base
        this.app.set('views', './webapp');

        // Permet de ne pas spécifier l'extension lors de l'utilisation de res.render()
        this.app.set('view engine', 'html');
        
    }
}
</code></pre>
<h3>Exercice 2</h3>
<p>Le moteur de template fonctionne. Nous allons le tester. </p>
<p>Actuellement dans le dossier <code>webapp</code>, vous avez une page <code>index.html</code>.
Cette page est incomplète et il nous manque le <code>header.html</code>
et le <code>footer.html</code>.</p>
<p>Commencez donc par inclure le <code>header.html</code> avec une instruction EJS (<a href="http://ejs.co/">doc</a>).</p>
<p>Ensuite essayez d'afficher la page.</p>
<h3>Exercice 3</h3>
<p>Pour résoudre le problème de l'exercice 2, il faut en réalité créer un controller nommé
<code>IndexCtrl</code> dans le dossier <code>src/pages</code> et indiquer explicitement à Express
que pour la page <code>index.html</code> ayant la route <code>/</code> il y une phase de rendu ou <code>render</code>
à effectuer. Voici les étapes à suivre :</p>
<ul>
<li>Créez l'<code>IndexCtrl</code> comme nous l'avions fait pour le service Rest.</li>
<li>Créez une nouvelle route pour la page index et utilisez la methode <code>response.render()</code>.</li>
</ul>
<p>Une fois que votre controlleur est en place vous devriez avoir l'entête de site disponible.</p>
<p>Vous pouvez inclure le footer !</p>
<blockquote>
<p>Note : Faite attention à l'ordre des middlewares !</p>
</blockquote>
<h3>Exercice 4</h3>
<p>Maintenant nous allons proposer une page d'accueil avec un peu de contenu sous forme de carte !</p>
<p>Voici un fragment html pour vous aider à faire cette exercice :</p>
<pre><code class="html">&#x3C;div class="card">
    &#x3C;div class="card-image waves-effect waves-block waves-light">
        &#x3C;img class="activator" src="images/">
    &#x3C;/div>
    &#x3C;div class="card-content">
        &#x3C;span class="card-title activator grey-text text-darken-4">
            label &#x3C;i class="material-icons right">more_vert&#x3C;/i>
        &#x3C;/span>

        &#x3C;p>&#x3C;a href="">Y aller !&#x3C;/a>&#x3C;/p>
    &#x3C;/div>

    &#x3C;div class="card-reveal">
        &#x3C;span class="card-title grey-text text-darken-4">
            label &#x3C;i class="material-icons right">fermer&#x3C;/i>
        &#x3C;/span>
        &#x3C;p>description&#x3C;/p>
    &#x3C;/div>
&#x3C;/div>
</code></pre>
<p>Nous avons dans le dossier <code>resources</code> un fichier <code>menu.json</code>. Nous allons utiliser
ce fichier pour créer une liste de carte dans la page d'accueil.</p>
<blockquote>
<p>Note : response.render() prend deux paramètres, le premier étant le nom de la page
html et le second étant des données (scope) pour générer notre vue.</p>
</blockquote>
<p>En utilisant les bonnes instructions EJS, essayez d'afficher la liste de carte. </p>
<p><strong>Bonus</strong></p>
<p>Il y a un bouton de téléchargement dans la page d'accueil. Essayez de le relier avec le service Rest <code>document</code>.</p>
<p><strong>Bonus 2</strong>
Le <code>header.html</code> doit afficher un menu de navigation (mobile et desktop).
Voici le fragment html pour vous aider :</p>
<pre><code class="html">&#x3C;li>&#x3C;a href="lien">label&#x3C;/a>&#x3C;/li>
</code></pre>
<blockquote>
<p>Correction : <a href="../../Resources/tp4-exercice-4-solution.zip">tp4-exercice-4-solution</a></p>
</blockquote>

<div id="tp5middlewaresformulaireservices"></div>
<h1>TP 5</h1>
<blockquote>
<p>Middlewares, Formulaire &#x26; Services</p>
</blockquote>
<p>L’objectif de ce TP est de créer un gestionnaire d’inscription au cours de Valtech Training comme présenté en capture ci-après :</p>
<p><img src="images/training.png" alt="capture"></p>
<h2>Exercice 1</h2>
<p>Avant de commencer à coder les nouvelles pages nous allons créer un middleware pour que nous n'ayons pas à
ajouter le <code>menu.json</code> dans chaque controlleur de page que nous allons créer.</p>
<p>Dans le <code>server.ts</code> nous allons rajouter la méthode suivante :</p>
<pre><code class="typescript">class Server {
    
    private middlewareMenu(response, request, next) {
        
        response.locals = {
            menu: require('./resources/menu.json'),
            navClass: ''
        };
        
        next();
    }
}
</code></pre>
<blockquote>
<p>locals est une variable globale d'Express. Elle permet d'y stocker des informations partagées au niveau d'un template.</p>
</blockquote>
<p>Ensuite ajoutez ce middleware au bon endroit dans la méthode <code>importMiddlewares()</code> de la même façon
que lorsque vous avez ajouté un middleware à Express.</p>
<h2>Exercice 2</h2>
<p>Nous allons développer la page <code>training.html</code> que vous pouvez récupérer depuis les sources du <a href="../../Resources/tp5-provided.zip">tp5-provided</a>.</p>
<p>Pour ce faire, nous allons créer un <code>TrainingCtrl</code> qui va gérer l'ensemble des pages de la section Training.</p>
<p>Ce contrôlleur va récupérer les données fournies dans le fichier <code>resources/courses.json</code>. Ces données vont nous permettre de créer
une liste de formation.</p>
<p>Cette même liste de formation sera présentée à l'utilisateur afin qu'il puisse s'inscrire à cette dernnière.</p>
<h2>Exercice 3</h2>
<p>Maintenant nous allons nous occuper du formulaire d'inscription <code>training-inscription.html</code>.</p>
<p>Il vous faut donc créer la nouvelle route pour accéder à la page <code>training-inscription.html</code> et
renvoyer une réponse dont voici l'exemple :</p>
<pre><code class="typescript">class TrainingCtrl extends Router {
    
    constructor() {
        // ...
    }
    
    private renderTrainingRegister = (request, response) => {
        
        response.render('training-inscription', {
              courses: require('../../../resources/courses.json'),
              participant: {
                  _id: '',
                  firstName: '',
                  lastName: '',
                  email: '',
                  course: request.params.course
              }
          });  
    }
  
}
</code></pre>
<p>Pour ce formulaire, il faudra créer les bons champs de saisie en fonction du modèle de données suivants :</p>
<pre><code class="json">{
    "lastName": "test",
    "firstName": "firstName",
    "email": "firstName@lastName.fr",
    "course": "angular"
}
</code></pre>
<blockquote>
<p>Il y a donc 4 champs à fournir dont course etant un liste déroulante.</p>
</blockquote>
<p>Voici un exemple pour créer une champs de saisie :</p>
<pre><code class="html">&#x3C;input id="lastName"
       name="lastName"
       type="text"
       class="validate"
       value="&#x3C;%= maValue ">
</code></pre>
<p>Et un autre exemple pour construire une ligne dans la liste déroulante des formations :</p>
<pre><code class="html">&#x3C;option value="&#x3C;%= course.value " 
        data-icon="/images/&#x3C;%= course.icon "
        class="left circle"
        &#x3C;%= course.value == participant.course ? 'selected' :'' >
        
    &#x3C;%= course.label 
&#x3C;/option>
</code></pre>
<h2>Exercice 4</h2>
<p>Votre formulaire est prêt, nous allons maintenant exposer des services Rest pour créer un participant.</p>
<p>Les actions demandées sont les suivantes :</p>
<ul>
<li>Lister les participants à la session,</li>
<li>Ajouter un participant,</li>
<li>Modifier un participant,</li>
<li>Supprimer un participant.</li>
</ul>
<p>Ces actions auront les routes suivantes :</p>
<table>
<thead>
<tr>
<th>Méthode</th>
<th>Endpoint</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET </td>
<td><code>/participants</code></td>
<td>Retourne la liste des participants.</td>
</tr>
<tr>
<td>POST</td>
<td><code>/participants</code></td>
<td>Ajoute un participant.</td>
</tr>
<tr>
<td>PUT</td>
<td><code>/participants/:id</code></td>
<td>Met à jour un participant.</td>
</tr>
<tr>
<td>DELETE</td>
<td><code>/participants/:id</code></td>
<td>Supprime un participant.</td>
</tr>
</tbody>
</table>
<h4>Installation</h4>
<p>Nous allons installer quelques middlewares pour gérer les données :</p>
<ul>
<li><a href="https://github.com/expressjs/body-parser"><code>body-parser</code></a> pour la gestion des paramètres envoyés en <code>POST</code>,</li>
<li><a href="https://github.com/expressjs/method-override"><code>method-override</code></a> pour gérer les verbes du protocole HTML.</li>
</ul>
<h4>Travail à faire</h4>
<p>Nous allons créer un nouveau controlleur <code>ParticipantCtrl</code> pour gérer les actions demandées.</p>
<p>Enfin pour persister les données dans un premier temps nous utiliserons un <code>ParticipantsService</code> que allons
développer dans le dossier <code>src/services</code>.</p>
<p>Ce service doit permettre d'ajouter / modifier / lister / supprimer un participant.</p>

<div id="tp6squaregameavecsocketio"></div>
<h1>TP 7</h1>
<blockquote>
<p>SquareGame avec Socket.io</p>
</blockquote>
<p>L’objectif de ce TP est d’utiliser Socket.io pour créer un mini jeu Client / Serveur en temps réel.</p>
<h2>Principe du jeu</h2>
<p>Le mini jeu oppose deux joueurs dans un duel de réflexe. Le jeu présente une grille sur laquelle apparaîtra de façon
aléatoire un carré coloré cliquable. Le premier joueur cliquant sur le carré obtient un point.
La partie est terminée lorsque l’un des joueurs atteint le score de 5 points.</p>
<p><img src="images/squaregame.png" alt="squaregame"></p>
<h2>Directives</h2>
<p>Pour ce TP la partie cliente est déjà développée.
Vous aurez donc à charge de développer la partie back-end, c’est-à-dire le serveur Socket. Ce serveur viendra se
greffer sur le serveur Express. Vous devrez gérer un certain nombre d’actions comme suivant :</p>
<ul>
<li>Gérer les connexions/déconnexions clients,</li>
<li>Gérer la file d’attente des joueurs,</li>
<li>Lancer la partie quand tous les joueurs sont prêts,</li>
<li>Envoyer à intervalle régulier la nouvelle position d’un carré,</li>
<li>Compter le score et synchroniser les informations entres les joueurs,</li>
<li>Indiquer le gagnant lorsque le score est atteint.</li>
</ul>
<h2>Rappel</h2>
<p>Voici un rappel du principe des communications entre le client et le server avec Socket.io :</p>
<p><img src="images/socket.png" alt="capture"></p>
<h2>Exercice</h2>
<blockquote>
<p>Si besoin vous avez les sources du <a href="../../Resources/tp6-provided.zip">tp6-provided</a></p>
</blockquote>
<h3>Installation</h3>
<pre><code class="bash">npm install --save socket.io
npm install --save-dev @types/socket.io
</code></pre>
<p>Copiez aussi le partial <a href="https://github.com/NodeAndTyped/labs-nodejs/blob/tp6-provided/webapp/partials/square-game.html"><code>webapp/partials/square-game.html</code></a>.</p>
<h3>1ère étape</h3>
<p>Nous devons créer une nouvelle classe pour gérer le server Socket.io. </p>
<p>Voici son squelette :</p>
<pre><code class="typescript">const settings = require('./../../../resources/square-game.json');

export default class SquareGameWS {
    /**
     *
     */
    static MAX_PLAYERS: number = settings.MAX_PLAYERS;
    /***
     *
     * @type {number}
     */
    static SCORE_MAX: number = settings.SCORE_MAX;
    /**
     *
     * @type {Map&#x3C;string, SocketIO.Socket>}
     */
    static players: Map&#x3C;string, PlayerSG> = new Map&#x3C;string, PlayerSG>();
    /**
     *
     */
    static tick;

    private player;

    constructor (
        private io: SocketIO.Server,
        private socket: SocketIO.Socket
    ) {

        console.log('New connection, ID =>', socket.id);

        //premier événement, ajout d'un utilisateur
        socket.on('client.player.add', this.onAddPlayer);

        //player say i'am ready
        socket.on('client.player.ready', this.onPlayerIsReady);

        //start interval
        socket.on('client.start.game', this.onStartGame);

        //delete square
        socket.on('client.delete.square', this.onDeleteSquare);

        //player disconnect
        socket.on('disconnect', this.onDisconnect);
    }

    /**
     * Ajoute une joueur à la liste des joueurs.
     * Emet l'événement 'newplayer' si le joueur vient d'être créé.
     * @param name
     */
    public onAddPlayer = (name: string): void => {};

    /**
     *
     * @param io
     */
    public onStartGame = (): void => {};

    /**
     *
     */
    public onPlayerIsReady = (): void => {};

    /**
     *
     */
    public onDeleteSquare = (): void => {};

    /**
     *
     */
    public onDisconnect = (): void => {};

    /**
     *
     */
    public updatePlayersReady(): void {}
    /**
     *
     */
    public sendSquarePosition = (): void => {};

    /**
     *
     * @returns {number}
     */
    static getNbPlayersReady(): number {
        
        return 0;
    }

    /**
     * Retourne la liste des joueurs.
     * @returns {Array}
     */
    static getPlayers(): PlayerSG[] {
    
        return null;
    }

    static stopGame(): void {}
}
</code></pre>
<p>Nous allons développer les méthodes nécessaires aux fonctionnement de notre jeu dans les étapes suivantes.</p>
<h3>2e étape</h3>
<p>Maintenant nous allons attacher le serveur Socket au serveur Express. Voici la façon de procédé :</p>
<pre><code class="typescript">class Server {
    private io: SocketIO.Server;

    start() {
        
        if (this.port) {
        
            const server = this.app.listen(this.port, () => {
                console.log(`Server binded on port ${this.port}`);
            });

            this.io = SocketIO(server);
            
            this.io.on('connection', (socket) => {
    
                new SquareGameWS(this.io, socket);
    
            });
        }
    }
}
</code></pre>
<h3>3e étape</h3>
<p>Nous allons réaliser les actions de notre jeu. Vous devrez développer les événements et méthodes qui suivent :</p>
<h4>Evénements entrants</h4>
<p><strong>client.player.add</strong></p>
<p>Cet événement gère l’ajout d’un joueur à la file d’attente.
Si la file d’attente est pleine, le joueur ne sera pas ajouté.
Dans le cas contraire la méthode ajoute l’utilisateur à la file
d’attente et un événement <a href="#serverplayernew"><code>server.player.new</code></a> est envoyé à tous les
clients connectés.</p>
<p><strong>client.player.ready</strong></p>
<p>Le client indique au serveur que le joueur enregistré est prêt à jouer.
La méthode doit stocker l’état du joueur est renvoyer la liste des joueurs
aux clients via l’évènement <a href="#serverupdateplayerready"><code>server.update.players.ready</code></a>.</p>
<p>Si tous joueurs sont prêts alors la méthode doit émettre un événement
 <a href="#serverstartcountdown"><code>server.start.countdown</code></a>.</p>
<p><strong>client.start.game</strong></p>
<p>Une fois que le <code>countdown</code> est terminé, les clients vont émettre un événement <code>client.start.game</code>. Cet événement côté
serveur lancera un « Timer » qui émettra à un intervalle régulier l’événement <a href="#serverupdatesquare"><code>server.update.square</code></a>.</p>
<p><strong>client.delete.square</strong></p>
<p>Cet événement est envoyé par un client lorsque le joueur clique sur le carré.
La méthode va donc incrémenter le score du joueur ayant cliqué le carré.
Un premier événement <a href="#serverdeletedsquare"><code>server.deleted.square</code></a> sera envoyé à l’ensemble des clients
pour indiquer que le carré est à supprimer.</p>
<p>Si le score de 5 points est atteint par l’un des joueurs, les actions suivantes sont effectuées :</p>
<ul>
<li>Interruption du « Timer ».</li>
<li>L’événement « playerloose » est diffusé.</li>
<li>L’événement « playerwin » est émis vers le client associé au socket.</li>
</ul>
<p><strong>disconnect</strong></p>
<p>Cet événement est généré lorsqu’un client se déconnecte du serveur.
L’objectif est de supprimer le joueur de la file d’attente est d’interrompre et de stopper le
« Timer » si il est actif. Un événement <code>server.stop.game</code> sera diffusé vers les clients connectés pour stopper le jeu.</p>
<h4>Evénements sortants</h4>
<p><strong>server.player.new</strong></p>
<p>Indique à l’ensemble des clients qu’un nouveau joueur est enregistré.</p>
<ul>
<li><strong>Type</strong> : broadcast</li>
<li><strong>Paramètre</strong> : La liste des joueurs.</li>
</ul>
<p><strong>server.update.player.ready</strong></p>
<p>Indique à l’ensemble des clients qu’un joueur est prêt à jouer.</p>
<ul>
<li><strong>Type</strong> : broadcast</li>
<li><strong>Paramètre</strong> : Liste des joueurs.</li>
</ul>
<p><strong>server.start.countdown</strong></p>
<p>Indique aux clients que tous les joueurs sont prêts et que le compte à rebours doit démarrer.</p>
<ul>
<li><strong>Type</strong> : broadcast</li>
<li><strong>Paramètre</strong> : aucun</li>
</ul>
<p><strong>server.update.square</strong></p>
<p>Indique aux clients la nouvelle position du carré à cliquer.</p>
<ul>
<li><strong>Type</strong> : broadcast</li>
<li><strong>Paramètre</strong> : un object square</li>
</ul>
<p><strong>server.deleted.square</strong></p>
<p>Indique à l’ensemble des joueurs que le carré a été cliqué par l’un des joueurs.</p>
<ul>
<li><strong>Type</strong> : broadcast</li>
<li>
<p><strong>Paramètres</strong> : </p>
<ul>
<li>La liste des joueurs,</li>
<li>Le joueur ayant cliqué le carré.</li>
</ul>
</li>
</ul>
<p><strong>server.player.loose</strong></p>
<p>Indique à l’ensemble des clients, sauf celui associé au socket, qu’ils ont perdu.</p>
<ul>
<li><strong>Type</strong> : socket.broadcast.emit</li>
<li><strong>Paramètre</strong> : Le joueur ayant gagné.</li>
</ul>
<p><strong>server.player.win</strong></p>
<p>Indique au client associé au socket qu’il a gagné.</p>
<ul>
<li><strong>Type</strong> : socket.emit</li>
<li><strong>Paramètre</strong> : Le joueur ayant gagné</li>
</ul>
<p><strong>server.stop.game</strong></p>
<p>Indique aux clients que le jeu est stoppé suite à la déconnexion d’un joueur.</p>
<ul>
<li>
<p><strong>Type</strong> : broadcast</p>
</li>
<li>
<p><strong>Paramètres</strong> :</p>
<ul>
<li>L’utilisateur déconnecté,</li>
<li>La liste des joueurs.</li>
</ul>
</li>
</ul>
<h3>Classe de donnée PlayerSG</h3>
<p>Voici un exemple de la structure d’un joueur :</p>
<pre><code class="typescript">export default class PlayerSG {

    /**
     *
     */
    name: string;
    /**
     *
     */
    isReady: boolean;
    /**
     *
     */
    private score: number = 0;

    constructor(private userId: string) {

    }

    /**
     *
     */
    public scoreUp(): void {
        this.score++;
    }

    /**
     *
     * @returns {number}
     */
    public getScore(): number {
        return this.score;
    }

    /**
     *
     */
    public toJSON = (): any => ({
        userId: this.userId,
        name: this.name,
        score: this.score,
        isReady: this.isReady
    });
}
</code></pre>
<h4>Modèle Square</h4>
<p>Voici un exemple du modèle de données d’un carré :</p>
<pre><code class="json">{
   "index": 1, 
   "bgc": "#FFFFFF"
}
</code></pre>
<p><strong>Règles :</strong></p>
<ul>
<li>La valeur de l’index est comprise entre 0 et 12. </li>
<li>La valeur de <code>bgc</code> est un code couleur hexadécimal.</li>
</ul>
<p>Ces deux valeurs sont à définir de façon aléatoire. Pour définir un code couleur
hexadécimal aléatoire voici un exemple de code :</p>
<pre><code class="typescript">"#" + ((1&#x3C;&#x3C;24) * Math.random() | 0).toString(16)
</code></pre>

<div id="tp7lespromises"></div>
<p>#TP7 </p>
<blockquote>
<p>Les promises</p>
</blockquote>

<div id="tp8basededonneesmongo"></div>
<h1>TP8</h1>
<blockquote>
<p>Base de données Mongo</p>
</blockquote>

<div id="tp9testunitaires"></div>
<h1>TP9</h1>
<blockquote>
<p>Les tests unitaires</p>
</blockquote>

<div id="aideimportationdesmodules"></div>
<h1>Importation d'un module</h1>
<h2>Node.js</h2>
<p>En Node.js l'importation d'un module se fait avec l'instruction <code>require('module')</code>.</p>
<pre><code class="javascript">var module = require('module');
</code></pre>
<h2>TypeScript/ES6</h2>
<p>En TypeScript/ES6 l'importation d'un module Node.js peut se faire de la façon suivante :</p>
<h4>Cas général</h4>
<pre><code class="typescript">import * as MonModule from "module";
</code></pre>
<p>Si il y a plusieurs fonction/classe/constante exportées dans le module source.</p>
<h4>Import sélectif</h4>
<pre><code class="typescript">import {maFonction} from "module";
</code></pre>
<p>Si il y a plusieurs fonction/classe/constante exportées dans le module source
mais que l'on souhaite utiliser une fonction du module.</p>
<h4>Importation par défaut</h4>
<pre><code class="typescript">import FonctionOuClassParDefaut from "module2"; // on récupère la fonction ou la classe exporté par défaut
</code></pre>
<p>Ne peut être utilisé que si le module utilise le mot clé <code>export default</code>. Exemple :</p>
<pre><code class="typescript">// server.ts
export default class Server {
    
}

// app.ts
import Server from "./server";

new Server();
</code></pre>

    </article>
</div>

<footer class="page-footer">

    <div class="container">

        <div class="row">
            <div class="col l12 s12">
                <p><a href="mailto:info@valtech.fr">info@valtech.fr</a></p>
                <p>Vous avez une vision concernant l'avenir digital de votre entreprise ? N'hésitez pas à nous contacter.</p>
                <p>Tél : 01 76 21 15 00</p>
                <p class="foot__offices">
                    <span>Aarhus | Amserfoort | Amsterdam | Bangalore | Bristol | Buenos Aires | Chicago | Copenhagen | Dallas | Düsseldorf | Eindhoven | Frankfurt | Geneva | Gurgaon | Göteborg | Honolulu | London | Malmö | Manchester | Montreal | Munich | New York | Paris | Singapore | Stockholm | Sydney | Uppsala | Utrecht | Västerås</span>
                </p>
            </div>
        </div>

        <div class="footer-social">
            <ul>
                <li><a href="https://www.facebook.com/valtech.fr"><i class="glyph" data-icon="facebook" title="Suivez-nous à facebook" aria-hidden="true"></i><span class="hidden">facebook</span></a></li>
                <li><a href="https://www.linkedin.com/company/valtech"><i class="glyph" data-icon="linkedin" title="Suivez-nous à linkedin" aria-hidden="true"></i><span class="hidden">linkedin</span></a></li>
                <li><a href="https://www.instagram.com/valtech_fr/"><i class="glyph" data-icon="instagram" title="Suivez-nous à instagram" aria-hidden="true"></i><span class="hidden">instagram</span></a></li>
                <li><a href="https://twitter.com/Valtech_FR"><i class="glyph" data-icon="twitter" title="Suivez-nous à twitter" aria-hidden="true"></i><span class="hidden">twitter</span></a></li>
            </ul>
        </div>



    </div>

    <div class="footer-copyright">
        <div class="container">

            © Valtech 2016

            <a  class="grey-text text-lighten-4 right"  href="http://valtech.fr/services/mentions-legales-cgu/">
                Mentions légales / CGU
            </a>

            </ul>
        </div>
    </div>

</footer>

<script type="text/javascript" src="assets/scripts/jquery.min.js"></script>
<script type="text/javascript" src="assets/scripts/materialize.min.js"></script>
<script type="text/javascript" src="assets/scripts/highlight.pack.js"></script>

<script>
    $( document ).ready(function(){
        $(".button-collapse").sideNav();
        $(".dropdown-button").dropdown();
    });
</script>


<script>
    hljs.initHighlightingOnLoad();
</script>

</body>
</html>